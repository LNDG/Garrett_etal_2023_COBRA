function [ common_coords ] = S_CommonCoords( DATAPATH, SAVEPATH, ID, S )
%Create a matrix of common cordinats of a sample
%   Detailed explanation goes here
%   Input:
%       DATAPATH: ...
%       S = 1 = save coords to DATAPATH
%           0 = do not save coords

% 14-10-20


%% calc binary mask and save file 
% S: Improve list collectio=n... 
% ID = dir('*01*'); 
% subjlist = ID.name; 

%initalize final coords; 1 to 1mio to ensure 1st subjects coords are all
%included
common_coords = (1:1000000);


for i = 1:numel(ID);  
   try
    
    %S: add S_load_nii...  
    %load nifti file
    %fname = [DATAPATH , ID{i}, '_BFT_ICA_denoised_MNI2mm_flirt.nii.gz'];
    fname = [DATAPATH , ID{i}, '.feat/filtered_func_data_restBPF.ica/', ID{i}, '_BPT_ICA_denoised_MNI2mm_flirt'];

    % load nifit form fname, unzip .gz and reshape ti
    [ data ] = S_load_nii_2d( fname );
       
    %resulting a matrix of intersecting coordinats over all subjects
    subj_coords = find(nii.img(:,:,:,1));%takes coords from first volume.
    common_coords=intersect(common_coords,subj_coords);
  
    disp ([ID{i}, ': added to common coords'])
  
  
   % Error log    
   catch ME
       warning(['error with subject ', ID{i}]);
   end
   
end

%% save
% S parameter activates save
if S ==1

    save ([SAVEPATH, 'commoncords.mat'], 'common_coords');
end

end

